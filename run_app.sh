#!/bin/bash

# ì„ ìƒë‹˜ í™ˆí˜ì´ì§€ Django ì•± ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

echo "ğŸ“ ì„ ìƒë‹˜ í™ˆí˜ì´ì§€ ì‹œì‘ ì¤‘..."
echo "=================================="

# í˜„ì¬ ë””ë ‰í† ë¦¬ í™•ì¸
if [ ! -f "manage.py" ]; then
    echo "âŒ Django í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ê°€ ì•„ë‹™ë‹ˆë‹¤."
    echo "   manage.py íŒŒì¼ì´ ìˆëŠ” ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”."
    exit 1
fi

# ê°€ìƒí™˜ê²½ í™•ì¸ ë° í™œì„±í™”
if [ ! -d "venv" ]; then
    echo "âŒ ê°€ìƒí™˜ê²½ì´ ì—†ìŠµë‹ˆë‹¤."
    echo "   python3 -m venv venv ëª…ë ¹ìœ¼ë¡œ ê°€ìƒí™˜ê²½ì„ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”."
    exit 1
fi

echo "ğŸ”§ ê°€ìƒí™˜ê²½ í™œì„±í™” ì¤‘..."
source venv/bin/activate

# í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ í™•ì¸
echo "ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜ í™•ì¸ ì¤‘..."
pip install -q -r requirements.txt

# ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸
echo "ğŸ—ƒï¸  ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸ ì¤‘..."
python manage.py makemigrations --check --dry-run > /dev/null 2>&1
if [ $? -ne 0 ]; then
    echo "âš ï¸  ìƒˆë¡œìš´ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ í•„ìš”í•©ë‹ˆë‹¤. ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤..."
    python manage.py makemigrations
    python manage.py migrate
else
    echo "âœ… ë°ì´í„°ë² ì´ìŠ¤ê°€ ìµœì‹  ìƒíƒœì…ë‹ˆë‹¤."
fi

# ì •ì  íŒŒì¼ ìˆ˜ì§‘ (í•„ìš”ì‹œ)
if [ ! -d "static" ]; then
    mkdir static
fi

echo ""
echo "ğŸš€ Django ê°œë°œ ì„œë²„ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
echo "=================================="
echo "ğŸ“± í™ˆí˜ì´ì§€: http://127.0.0.1:8000/"
echo "ğŸ‘¨â€ğŸ’¼ ê´€ë¦¬ì í˜ì´ì§€: http://127.0.0.1:8000/admin/"
echo ""
echo "ê´€ë¦¬ì ê³„ì •:"
echo "  ì•„ì´ë””: admin"
echo "  ë¹„ë°€ë²ˆí˜¸: admin123"
echo ""
echo "ì„œë²„ë¥¼ ì¤‘ì§€í•˜ë ¤ë©´ Ctrl+Cë¥¼ ëˆ„ë¥´ì„¸ìš”."
echo "=================================="
echo ""

# Django ì„œë²„ ì‹¤í–‰
python manage.py runserver 